
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>samoyed.core &#8212; samoyed  文档</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">samoyed  文档</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">模块代码</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">samoyed.core</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>samoyed.core 源代码</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">lt</span><span class="p">,</span> <span class="n">le</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">ge</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">not_</span><span class="p">,</span> <span class="n">or_</span><span class="p">,</span> <span class="n">and_</span> \
    <span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">truediv</span><span class="p">,</span> <span class="n">floordiv</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">lark</span>
<span class="kn">from</span> <span class="nn">lark</span> <span class="kn">import</span> <span class="n">Lark</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">from</span> <span class="nn">lark.exceptions</span> <span class="kn">import</span> <span class="n">UnexpectedToken</span><span class="p">,</span> <span class="n">UnexpectedEOF</span>
<span class="kn">from</span> <span class="nn">lark.indenter</span> <span class="kn">import</span> <span class="n">Indenter</span>

<span class="kn">from</span> <span class="nn">.exception</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.libs</span> <span class="kn">import</span> <span class="n">TimeControl</span><span class="p">,</span> <span class="n">arg_seq_add</span><span class="p">,</span> <span class="n">arg_option_add</span><span class="p">,</span> <span class="n">mock_add</span><span class="p">,</span> <span class="n">sqlite</span><span class="p">,</span> <span class="n">sqlite_connect</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">解释器核心</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="SamoyedIndenter"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedIndenter">[文档]</a><span class="k">class</span> <span class="nc">SamoyedIndenter</span><span class="p">(</span><span class="n">Indenter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    间隔控制</span>
<span class="sd">    会将若干空格转换_INDENT终结符</span>
<span class="sd">    如果空格数量不同，转换出的_INDENT也会不同</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NL_type</span> <span class="o">=</span> <span class="s1">&#39;_NEWLINE&#39;</span>
    <span class="n">OPEN_PAREN_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">CLOSE_PAREN_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">INDENT_type</span> <span class="o">=</span> <span class="s1">&#39;_INDENT&#39;</span>
    <span class="n">DEDENT_type</span> <span class="o">=</span> <span class="s1">&#39;_DEDENT&#39;</span>
    <span class="n">tab_len</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># 制表符转换出4个空格的_INDENT</span></div>


<div class="viewcode-block" id="SamoyedTransformer"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedTransformer">[文档]</a><span class="k">class</span> <span class="nc">SamoyedTransformer</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    基础的语法制导，只会转换一些常量。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">none</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dollar</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># type: set[str]</span>

<div class="viewcode-block" id="SamoyedTransformer.FLOAT"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedTransformer.FLOAT">[文档]</a>    <span class="k">def</span> <span class="nf">FLOAT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamoyedTransformer.INT"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedTransformer.INT">[文档]</a>    <span class="k">def</span> <span class="nf">INT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamoyedTransformer.STR"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedTransformer.STR">[文档]</a>    <span class="k">def</span> <span class="nf">STR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="SamoyedTransformer.DOLLAR_VAR"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.SamoyedTransformer.DOLLAR_VAR">[文档]</a>    <span class="k">def</span> <span class="nf">DOLLAR_VAR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
        <span class="c1"># 只用于追踪dollar变量</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dollar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="Context"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Context">[文档]</a><span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    上下文</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Context.__init__"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Context.__init__">[文档]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dollar_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Notes</span>
<span class="sd">        ---------</span>
<span class="sd">            绑定内置函数，变量，外部传入的参数到内部的参数表中。</span>
<span class="sd">            对于外部传入的dollar_names，如果有包含名字叫mg的方法会被过滤掉</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names</span>
<span class="sd">            外部传入的变量表</span>
<span class="sd">        dollar_names</span>
<span class="sd">            传入的参数</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$PWD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="c1"># 给外部传入的属性加上$</span>
        <span class="k">if</span> <span class="n">dollar_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dollar_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mg&quot;</span><span class="p">):</span> <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dollar_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># 绑定内置函数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn2curosr</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type:Dict[sqlite3.Cursor,sqlite3.Connection]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;print&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;speak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">print</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;listen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;exit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;arg_seq_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">arg_seq_add</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;arg_option_add&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">arg_option_add</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;sqlite_connect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">sqlite_connect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn2curosr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;sqlite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">sqlite</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn2curosr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="nb">str</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="c1"># 状态初始化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type:lark.tree.Tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type:lark.tree.Tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__exit</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Context.is_exit"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Context.is_exit">[文档]</a>    <span class="k">def</span> <span class="nf">is_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;判断当前程序是否已经退出</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            当前程序是否已经退出</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exit</span></div>

<div class="viewcode-block" id="Context.set_exit"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Context.set_exit">[文档]</a>    <span class="k">def</span> <span class="nf">set_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;设置当前程序退出</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__exit</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Interpreter"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter">[文档]</a><span class="k">class</span> <span class="nc">Interpreter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;解释器类</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 语法制导。用于构件AST时转换一些常量</span>
    <span class="c1"># 因为每次语法制导</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">SamoyedTransformer</span><span class="p">()</span>

    <span class="c1"># 读取文法</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/samoyed.gram&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">Lark</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;lalr&#39;</span><span class="p">,</span> <span class="n">postlex</span><span class="o">=</span><span class="n">SamoyedIndenter</span><span class="p">(),</span> <span class="n">transformer</span><span class="o">=</span><span class="n">transformer</span><span class="p">)</span>

<div class="viewcode-block" id="Interpreter.__init__"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.__init__">[文档]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dont_init</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        code: Union[str, lark.Tree]</span>
<span class="sd">            代码</span>
<span class="sd">        context:dict</span>
<span class="sd">            额外的上下文</span>
<span class="sd">        args:dict</span>
<span class="sd">            命令行等特殊参数</span>
<span class="sd">        dont_init:bool</span>
<span class="sd">            是否执行初始化</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isinit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">dollar</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># 词法和语法分析</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># 如果传入的是代码</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>  <span class="c1"># type:lark.tree.Tree</span>
                <span class="c1"># 提取出扫描到的dollar符号</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dollar_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">dollar</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">UnexpectedEOF</span><span class="p">,</span> <span class="n">UnexpectedToken</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SamoyedSyntaxError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">expected</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">column</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 否则直接绑定</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ast</span> <span class="o">=</span> <span class="n">code</span>

        <span class="c1"># 建立上下文</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">dollar_names</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># 初始化会执行所有外部的语句。</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dont_init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></div>

<div class="viewcode-block" id="Interpreter.init"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.init">[文档]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;执行所有外部的语句</span>
<span class="sd">        外部的语句指下面这种情况：</span>
<span class="sd">        x = 1</span>
<span class="sd">        state main:</span>
<span class="sd">            pass</span>
<span class="sd">        这里x=1就是外部的语句</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entrance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># 遍历AST的顶层，确定所有的stage和入口</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;statedef&#39;</span><span class="p">:</span>
                <span class="c1"># 如果是状态定义</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 第一个子节点是名称</span>
                <span class="c1"># 如果是入口，绑定入口点</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">entrance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 如果不是状态，那么直接执行</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># 如果没有入口，报错</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SamoyedNotFoundEntrance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entrance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isinit</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Interpreter.exec"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.exec">[文档]</a>    <span class="k">def</span> <span class="nf">exec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;解释执行程序</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isinit</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="c1"># 遍历并执行每个状态中的语句</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
                <span class="c1"># 如果调用了exit，直接退出</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">is_exit</span><span class="p">():</span>
                    <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># 如果未指定下一个状态，那么结束</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 如果指定了状态跳到该状态</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Interpreter.exec_statement"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.exec_statement">[文档]</a>    <span class="k">def</span> <span class="nf">exec_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Tree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;执行每一个语句</span>
<span class="sd">        可执行的语句有以下几种：</span>
<span class="sd">        * simple_stmt 简单的语句，包括赋值表达式，跳转表达式，pass表达式和普通表达式</span>
<span class="sd">        * if_stmt if语句</span>
<span class="sd">        * match_stmt 包括普通的match和可以控制输入时间的match</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stat</span>
<span class="sd">            语句的语法分析结果</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">            `SamoyedRuntimeError`:</span>
<span class="sd">                其他运行错误</span>
<span class="sd">            `SamoyedTypeError`:</span>
<span class="sd">                类型错误</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;simple_stmt&quot;</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果是一个简单的表达式</span>
<span class="sd">            simple_stmt包括：</span>
<span class="sd">            * pass_expr 什么也不做.</span>
<span class="sd">            * branch_expr 跳转表达式</span>
<span class="sd">            * _full_expr 一个普通表达式，如果这个表达式非过程，那么它是无副作用的</span>
<span class="sd">            * assign_expr 赋值表达式</span>
<span class="sd">            </span>
<span class="sd">            对于simple_stmt，其语法分析的结果类似下面的结构：</span>
<span class="sd">            simple_stmt</span>
<span class="sd">                |</span>
<span class="sd">               expr </span>
<span class="sd">                |</span>
<span class="sd">               ...</span>
<span class="sd">            通过判断children[0]的类型，即可知道它是什么表达式</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">simple_stmt</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># 如果是终结符，那么不需要再处理了</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simple_stmt</span><span class="p">,</span><span class="n">lark</span><span class="o">.</span><span class="n">Tree</span><span class="p">):</span><span class="k">return</span>

            <span class="n">simple_stmt_type</span> <span class="o">=</span> <span class="n">simple_stmt</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">simple_stmt_type</span> <span class="o">==</span> <span class="s2">&quot;branch_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                是一个跳转语句</span>
<span class="sd">                branch_expr</span>
<span class="sd">                    |</span>
<span class="sd">                   node(NAME)</span>
<span class="sd">                NAME即要跳转到的状态名</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">next_state</span> <span class="o">=</span> <span class="n">simple_stmt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">next_state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">[</span><span class="n">next_state</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SamoyedNameError</span>

            <span class="k">elif</span> <span class="n">simple_stmt_type</span> <span class="o">==</span> <span class="s2">&quot;assign_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                是一个赋值语句</span>
<span class="sd">                assign_expr</span>
<span class="sd">                    |</span>
<span class="sd">                ┌───┬─────┐</span>
<span class="sd">                var =    expr</span>
<span class="sd">                simple_stmt.children[0].value -&gt; var</span>
<span class="sd">                simple_stmt.children[2]       -&gt; expr</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">simple_stmt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">simple_stmt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">simple_stmt_type</span> <span class="o">==</span> <span class="s2">&quot;pass_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                是跳过语句</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                是一个普通的表达式</span>
<span class="sd">                直接执行即可</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">stat</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;match_stmt&quot;</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            match字句有两种形式</span>
<span class="sd">            第一种形式是**带有时间控制**的匹配</span>
<span class="sd">            其中，@的第一个参数是超时时间，必选；第二个参数是最少持续时间，可选；</span>
<span class="sd">            @后应该接入一个函数调用。延时表达式会不断调用这个函数</span>
<span class="sd">            ```</span>
<span class="sd">            match @(10,2)funcall :</span>
<span class="sd">                compare_expr =&gt;</span>
<span class="sd">                    stat</span>
<span class="sd">                ...</span>
<span class="sd">                silence =&gt;</span>
<span class="sd">                    stat</span>
<span class="sd">            ```        </span>
<span class="sd">            第二种形式是普通的多值匹配</span>
<span class="sd">            ```</span>
<span class="sd">            match expr :</span>
<span class="sd">                compare_expr =&gt;</span>
<span class="sd">                    stat</span>
<span class="sd">                compare_expr =&gt;</span>
<span class="sd">                    stat</span>
<span class="sd">                default =&gt;</span>
<span class="sd">                    stat</span>
<span class="sd">            ```</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># expr</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Tree</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;at_expr&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__time_control_match</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__normal_match</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">stat</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;if_stmt&quot;</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果是if语句</span>
<span class="sd">                 if_stmt</span>
<span class="sd">                    |</span>
<span class="sd">            ┌───────┬─────────┐</span>
<span class="sd">            expr  true_st false_st</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">bool_expr</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">bool_expr</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SamoyedNotImplementError</span></div>

<div class="viewcode-block" id="Interpreter.get_expression"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.get_expression">[文档]</a>    <span class="k">def</span> <span class="nf">get_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Tree</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)]:</span>
        <span class="sd">&quot;&quot;&quot;获取表达式的值</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr 表达式树</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            表达式运算后的结果。可能是常量，也可能是一个函数</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">            `SamoyedRuntimeError`:</span>
<span class="sd">                其他运行错误</span>
<span class="sd">            `SamoyedTypeError`:</span>
<span class="sd">                类型错误</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果是终结符....</span>
<span class="sd">            </span>
<span class="sd">            终结符有type和value两个域。</span>
<span class="sd">            type是类型，</span>
<span class="sd">            value是其值</span>
<span class="sd">            </span>
<span class="sd">            有以下几种终结符表达式：</span>
<span class="sd">            * FLOAT(语法制导处理)</span>
<span class="sd">            * INT(语法制导处理)</span>
<span class="sd">            * STR(语法制导处理)</span>
<span class="sd">            * &quot;none&quot;(语法制导处理)</span>
<span class="sd">            * &quot;true&quot;(语法制导处理)</span>
<span class="sd">            * &quot;false&quot;(语法制导处理)</span>
<span class="sd">            * NAME,DOLLAR_VAR(查表）</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;STR&quot;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="ow">or</span> \
                    <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span> <span class="ow">or</span> \
                    <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SIGNED_INT&quot;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;SIGNED_FLOAT&quot;</span><span class="p">:</span>
                <span class="c1"># 如果是一些常量，直接返回</span>
                <span class="k">return</span> <span class="n">expr</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;NAME&quot;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;DOLLAR_VAR&quot;</span><span class="p">:</span>
                <span class="c1"># 查看是否有该变量</span>
                <span class="n">_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">var</span> <span class="o">:=</span> <span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">var</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SamoyedNameError</span><span class="p">(</span><span class="s2">&quot;No such variable </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SamoyedInterpretError</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">column</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">expr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果是普通的常量</span>
<span class="sd">            直接返回</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">expr</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">lark</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">Tree</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果是非终结符...</span>
<span class="sd">            </span>
<span class="sd">            非终结符是一棵树</span>
<span class="sd">            形式为： (data=....,children=Tree[...])</span>
<span class="sd">            </span>
<span class="sd">            有以下几种非终结符表达式：</span>
<span class="sd">            * conditional_expr: 三目表达式。</span>
<span class="sd">            * or_test: 子句之间做逻辑或运算</span>
<span class="sd">            * and_test: 子句之间做逻辑与运算</span>
<span class="sd">            * not_test: 子句之间做逻辑非运算</span>
<span class="sd">            * compare_expr: 两个子句之间根据逻辑运算符做比较。</span>
<span class="sd">            * plus_expr: 子句之间根据加减符号运算</span>
<span class="sd">            * mul_expr： 子句之间根据乘除等符号做运算</span>
<span class="sd">            * factor：正负号</span>
<span class="sd">            * funccall：函数调用，从符号表中取变量</span>
<span class="sd">            * REG ：正则表达式</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;add_op&#39;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;mul_op&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arith_operator</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;conditional_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                如果是条件表达式..</span>
<span class="sd">                类似if语句的处理</span>
<span class="sd">                conditional_expr : bool_expr?first:second</span>
<span class="sd">                bool_expr = expr.children[0]</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">bool_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">bool_expr</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;compare_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                如果是比较表达式....</span>
<span class="sd">                </span>
<span class="sd">                compare_expr : left compare_expr right</span>
<span class="sd">                compare_operator : expr.children[1].children[0]</span>
<span class="sd">                left = expr.children[0] 左边的表达式</span>
<span class="sd">                right = expr.children[2] 右边的表达式</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_operator</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># 两种类型可能不能比较</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SamoyedTypeError</span><span class="p">(</span><span class="s2">&quot;can not compare</span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">left</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">right</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;not_test&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                not表达式</span>
<span class="sd">                not_test : &quot;not&quot; test_expr</span>
<span class="sd">                test_expr = expr.children[0]</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">not_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;or_test&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                or表达式。</span>
<span class="sd">                这里可能有多个参数，因此这里用了reduce</span>
<span class="sd">                or_test : expr1 &quot;or&quot; expr2 &quot;or&quot; expr3 &quot;or&quot; ....</span>
<span class="sd">                expr1 = expr.children[0]</span>
<span class="sd">                expr2 = expr.children[1]</span>
<span class="sd">                ...</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">or_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;and_test&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                and表达式，同上</span>
<span class="sd">                and_test : expr1 &quot;and_&quot; expr2 &quot;and_&quot; expr3 &quot;and_&quot; ....</span>
<span class="sd">                expr1 = expr.children[0]</span>
<span class="sd">                expr2 = expr.children[1]</span>
<span class="sd">                ...</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">and_</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;plus_expr&quot;</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;mul_expr&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                加法或乘法</span>
<span class="sd">                其结构形如：</span>
<span class="sd">                [1,+,2,-,3]或者[1,*,2,//,3]</span>
<span class="sd">                因此不能直接用reduce。这里改造了一下reduce</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SamoyedRuntimeError</span><span class="p">(</span><span class="s2">&quot;can not compute </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;factor&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                加上正负号。</span>
<span class="sd">                这里可能操作对象是字符串</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">SamoyedTypeError</span><span class="p">(</span><span class="s2">&quot;can not add &#39;-&#39; to string&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="o">-</span><span class="n">tmp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">tmp</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;funccall&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                函数调用</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">func</span> <span class="o">:=</span> <span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># 如果有参数</span>
                            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="c1"># 函数可能会崩溃</span>
                        <span class="k">raise</span> <span class="n">SamoyedRuntimeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SamoyedNameError</span><span class="p">(</span><span class="s2">&quot;No such function </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;reg&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                如果是正则表达式...</span>
<span class="sd">                直接编译后，返回</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SamoyedNotImplementError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SamoyedNotImplementError</span></div>

<div class="viewcode-block" id="Interpreter.reduce"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter.reduce">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Union</span><span class="p">[</span><span class="n">Number</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        计算形如数值、函数混合列表的值</span>
<span class="sd">        大致原理是，分为奇数位和偶数位进行计算。</span>
<span class="sd">        奇数位都是操作数，偶数为都是操作符。</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        l:</span>
<span class="sd">            操作数和操作符的序列，形如[1,+,2,-,3]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            运算结果</span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">            `SamoyedRuntimeError`:</span>
<span class="sd">                其他运行错误</span>
<span class="sd">            `SamoyedTypeError`:</span>
<span class="sd">                类型错误</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">SamoyedRuntimeError</span><span class="p">(</span><span class="s2">&quot;列表个数不为奇数&quot;</span><span class="p">)</span>
        <span class="n">operand2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">op</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                从1开始，步长为2，每次应该都要取到函数</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">operand2</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">operand2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># 出现字符串加数字等类型错误</span>
            <span class="k">raise</span> <span class="n">SamoyedTypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">和</span><span class="si">{}</span><span class="s2">无法做</span><span class="si">{}</span><span class="s2">运算&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">sum</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">operand2</span><span class="p">),</span> <span class="n">op</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SamoyedRuntimeError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">sum</span></div>

<div class="viewcode-block" id="Interpreter._match_value"><a class="viewcode-back" href="../../source/samoyed.html#samoyed.core.Interpreter._match_value">[文档]</a>    <span class="k">def</span> <span class="nf">_match_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value1</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                     <span class="n">value2</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        判断节点的值是否匹配</span>
<span class="sd">        如果是正则匹配会返回匹配结果</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value1</span>
<span class="sd">            要匹配的值</span>
<span class="sd">        value2</span>
<span class="sd">            匹配的值2，可以是正则表达式。判断value1是否满足正则表达式的pattern</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            bool 匹配是否成功</span>
<span class="sd">            result 匹配结果</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">value1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value2</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            如果node是正则表达式</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">value2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            否则，先计算出值，直接进行值的比较</span>
<span class="sd">            如果两个对象都是字符串，value2只要是value1的子串即可</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value1</span> <span class="o">==</span> <span class="n">value2</span><span class="p">,</span> <span class="kc">None</span></div>
    <span class="k">def</span> <span class="nf">__normal_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        如果是简单的switch型match</span>
<span class="sd">        语法分析的树大致如下：</span>
<span class="sd">            match_stmt</span>
<span class="sd">                 |</span>
<span class="sd">        ┌──────────────┬────────────┬─────────────┐</span>
<span class="sd">        expr0      match_case1  match_case..   default</span>
<span class="sd">                       |                          |</span>
<span class="sd">                  ┌────┬──────┐                ┌────┐</span>
<span class="sd">                expr1 stmt1  ...            stmt1  ...</span>

<span class="sd">        match_case1中的expr1如果是字符串，那么其语义是:</span>
<span class="sd">        如果expr0中存在子串expr1，则匹配成功（而不需要expr0==expr1)</span>

<span class="sd">        match_case1中的expr1如果是正则表达式，则按正则表达式的匹配处理</span>

<span class="sd">        其他情况按expr0==expr1处理</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">expr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">case_statment</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># stat.children[0]是bool表达式</span>
            <span class="k">if</span> <span class="n">case_statment</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;default_stmt&quot;</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                如果是默认情况，直接执行这个语句</span>
<span class="sd">                parser解析的结果保证默认情况在最后面</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c1"># 执行块中的每个语句</span>
                <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">case_statment</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">break</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                否则，判断值相同才执行</span>
<span class="sd">                字符串只要包含子串就会执行                        </span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">matching_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">case_statment</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">is_matched</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_value</span><span class="p">(</span><span class="n">matching_value</span><span class="p">,</span> <span class="n">expr_result</span><span class="p">)</span>
                <span class="c1"># 如果匹配成功</span>
                <span class="c1"># 如果为正则表达式，保存组的结果</span>
                <span class="c1"># 跳出循环，结束</span>
                <span class="k">if</span> <span class="n">is_matched</span><span class="p">:</span>
                    <span class="c1"># 执行块中的每个语句</span>
                    <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">case_statment</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$mg0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">()):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$mg</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="k">break</span>
    <span class="k">def</span> <span class="nf">__time_control_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        如果是限定时间的语句...</span>
<span class="sd">        会尝试一直读取值，直到超时或者匹配成功</span>
<span class="sd">        语法分析的树大致如下：</span>
<span class="sd">            match_stmt</span>
<span class="sd">                 |</span>
<span class="sd">        ┌─────────────────────────────────┬────────────┬─────────────┐</span>
<span class="sd">        expr0                          match_case1  match_case..  silence</span>
<span class="sd">        |                                 |                          |</span>
<span class="sd">        ┌────────┬─────────┐         ┌────┬──────┐                 ┌────┐</span>
<span class="sd">        at_para func    func_para   expr1 stmt1  ...              stmt1  ...</span>

<span class="sd">        * match_case1中的expr1如果是字符串，那么其语义是:</span>
<span class="sd">            如果expr0中存在子串expr1，则匹配成功（而不需要expr0==expr1)</span>

<span class="sd">        * match_case1中的expr1如果是正则表达式，则按正则表达式的匹配处理</span>

<span class="sd">        * 其他情况按expr0==expr1处理</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stat</span>
<span class="sd">            执行的time_control语句</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># 下面首先是获取@()func()的函数</span>
        <span class="c1"># expr.children[0] -&gt; @内部的参数，用于控制时间</span>
        <span class="c1"># expr.children[1] -&gt; func的函数名</span>
        <span class="c1"># expr.children[2] -&gt; func的参数，可能为None</span>
        <span class="n">_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">func</span> <span class="o">:=</span> <span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># 如果有参数</span>
                <span class="k">assert</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SamoyedNameError</span><span class="p">(</span><span class="s2">&quot;No such function </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># 接着构造定时器</span>
        <span class="c1"># 构造一个TimeControl对象。将这个函数传入构造</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">TimeControl</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>

        <span class="c1"># 预先算出每个case的表达式，不包含silence字句</span>
        <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_expression</span><span class="p">(</span><span class="n">case_statment</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">case_statment</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span>
                 <span class="n">case_statment</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="s2">&quot;silence_stmt&quot;</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># 每次读取的值</span>
        <span class="n">find_flag</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否完成匹配</span>
        <span class="n">finded_case</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># 匹配的是第几个</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        开始执行匹配</span>

<span class="sd">        允许断断续续地输入，</span>
<span class="sd">        每一次新的输入都会更新值并判断结果是否匹配</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">control</span><span class="p">():</span>
            <span class="c1"># 如果新的结果不为空，保存</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">+=</span> <span class="n">result</span>

            <span class="c1"># 如果当前时间不允许退出，那么即使匹配了也无法退出</span>
            <span class="c1"># 这种情况下，直接跳过即可</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">control</span><span class="o">.</span><span class="n">can_exit</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span> <span class="k">continue</span>

            <span class="c1"># 依次对每个case进行判断</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cases</span><span class="p">):</span>
                <span class="c1"># 拼接结果</span>
                <span class="n">concat_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                匹配结果:</span>
<span class="sd">                会返回一个bool变量和一个匹配结果。</span>
<span class="sd">                如果是正则表达式，匹配结果才有效</span>
<span class="sd">                匹配结果保存的是分组后的信息</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">is_matched</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_value</span><span class="p">(</span><span class="n">concat_result</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_matched</span><span class="p">:</span>
                    <span class="n">find_flag</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">finded_case</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">control</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

                    <span class="c1"># 将正则匹配结果绑定到特殊变量上</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$mg0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">groups</span><span class="p">()):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;$mg</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="k">break</span>

            <span class="c1"># 如果匹配，那么执行这个子块，并返回</span>
            <span class="k">if</span> <span class="n">find_flag</span> <span class="ow">and</span> <span class="n">control</span><span class="o">.</span><span class="n">can_exit</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">finded_case</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="k">break</span>
                <span class="k">return</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        匹配块结束....</span>
<span class="sd">        如果超时了，并且没有完成任何匹配...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 如果有silence块，执行silence块</span>
        <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;silence_stmt&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stat</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="c1"># 执行块中的每个语句</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exec_statement</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="k">break</span>

    <span class="n">compare_operator</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="n">gt</span><span class="p">,</span>
        <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="n">lt</span><span class="p">,</span>
        <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="n">ge</span><span class="p">,</span>
        <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="n">le</span><span class="p">,</span>
        <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="n">eq</span><span class="p">,</span>
        <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="n">ne</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">arith_operator</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="n">mock_add</span><span class="p">,</span>
        <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="n">sub</span><span class="p">,</span>
        <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="n">mul</span><span class="p">,</span>
        <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">truediv</span><span class="p">,</span>
        <span class="s2">&quot;//&quot;</span><span class="p">:</span> <span class="n">floordiv</span><span class="p">,</span>
        <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="n">mod</span>
    <span class="p">}</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">samoyed  文档</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >模块代码</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">samoyed.core</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2021, ruiqurm.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>